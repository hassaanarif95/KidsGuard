<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KidsGuard â€” Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <link rel="icon" href="https://fav.farm/ðŸ“Š">
  <script>
    const savedTheme = localStorage.getItem("kg-theme");
    if (savedTheme === "dark") document.documentElement.classList.add("dark");

    // simple auth guard
    if (localStorage.getItem("kg-auth") !== "true") {
      location.replace("login.html");
    }
  </script>
</head>
<body class="h-full bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100">
  <!-- Topbar -->
  <header class="sticky top-0 z-10 bg-white/80 dark:bg-slate-900/80 backdrop-blur border-b border-slate-200/60 dark:border-slate-700">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-emerald-600 font-bold text-xl">KidsGuard</span>
        <span class="hidden sm:inline text-sm text-slate-500 dark:text-slate-400">Dashboard</span>
      </div>
      <div class="flex items-center gap-2">
        <button id="themeBtn" class="px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 text-sm">Toggle Theme</button>
        <button onclick="logout()" class="px-3 py-2 rounded-xl bg-rose-600 text-white text-sm hover:bg-rose-700">Logout</button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-7xl px-4 py-8 space-y-8">
    <!-- Welcome -->
    <section class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <h1 class="text-2xl font-bold">Welcome, <span id="parentName"></span> ðŸ‘‹</h1>
        <p class="text-slate-600 dark:text-slate-300">Hereâ€™s todayâ€™s snapshot for your childâ€™s device.</p>
      </div>
      <div class="flex gap-2">
        <button class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700" onclick="refreshDemo()">Refresh Data</button>
        <a class="px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700" href="index.html">Home</a>
      </div>
    </section>

    <!-- Stat cards -->
    <section class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <div class="p-5 rounded-2xl bg-white dark:bg-slate-800 shadow-sm border border-slate-200/60 dark:border-slate-700">
        <p class="text-sm text-slate-500">Screen Time (today)</p>
        <p id="statScreen" class="mt-2 text-2xl font-bold">â€”</p>
      </div>
      <div class="p-5 rounded-2xl bg-white dark:bg-slate-800 shadow-sm border border-slate-200/60 dark:border-slate-700">
        <p class="text-sm text-slate-500">Top App</p>
        <p id="statTopApp" class="mt-2 text-2xl font-bold">â€”</p>
      </div>
      <div class="p-5 rounded-2xl bg-white dark:bg-slate-800 shadow-sm border border-slate-200/60 dark:border-slate-700">
        <p class="text-sm text-slate-500">Web Visits</p>
        <p id="statSites" class="mt-2 text-2xl font-bold">â€”</p>
      </div>
      <div class="p-5 rounded-2xl bg-white dark:bg-slate-800 shadow-sm border border-slate-200/60 dark:border-slate-700">
        <p class="text-sm text-slate-500">Last Sync</p>
        <p id="statSync" class="mt-2 text-2xl font-bold">â€”</p>
      </div>
    </section>

    <!-- Charts -->
    <section class="grid lg:grid-cols-2 gap-6">
      <div class="p-5 rounded-2xl bg-white dark:bg-slate-800 shadow-sm border border-slate-200/60 dark:border-slate-700">
        <h2 class="font-semibold mb-3">Hourly Screen Time</h2>
        <canvas id="chartHours" height="220"></canvas>
      </div>
      <div class="p-5 rounded-2xl bg-white dark:bg-slate-800 shadow-sm border border-slate-200/60 dark:border-slate-700">
        <h2 class="font-semibold mb-3">App Usage Split</h2>
        <canvas id="chartApps" height="220"></canvas>
      </div>
    </section>

    <!-- Activity Table -->
    <section class="p-5 rounded-2xl bg-white dark:bg-slate-800 shadow-sm border border-slate-200/60 dark:border-slate-700">
      <div class="flex items-center justify-between mb-3">
        <h2 class="font-semibold">Recent Web Activity</h2>
        <input id="search" class="px-3 py-2 rounded-xl border bg-white dark:bg-slate-900 border-slate-300 dark:border-slate-700 text-sm" placeholder="Search site...">
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-left text-sm">
          <thead class="text-slate-500">
            <tr>
              <th class="py-2 pr-4">Time</th>
              <th class="py-2 pr-4">Website</th>
              <th class="py-2 pr-4">Category</th>
              <th class="py-2">Duration</th>
            </tr>
          </thead>
          <tbody id="rows" class="divide-y divide-slate-200/60 dark:divide-slate-700"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    // theme toggle
    document.getElementById("themeBtn").onclick = () => {
      document.documentElement.classList.toggle("dark");
      localStorage.setItem("kg-theme",
        document.documentElement.classList.contains("dark") ? "dark" : "light"
      );
    };
    // display parent name
    document.getElementById("parentName").textContent = localStorage.getItem("kg-parent") || "Parent";

    function logout(){
      localStorage.removeItem('kg-auth');
      location.href = 'login.html';
    }

    // ----- Demo data + helpers -----
    function randomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}
    function demoData(){
      const hours = Array.from({length:12},(_,i)=>8+i); // 8am-8pm
      const mins = hours.map(()=>randomInt(5,35));
      const apps = { YouTube: randomInt(40,90), WhatsApp: randomInt(20,60), Instagram: randomInt(10,40), TikTok: randomInt(10,35), Chrome: randomInt(15,50) };
      const totalMin = mins.reduce((a,b)=>a+b,0);
      const sites = [
        {t:"08:42", s:"khanacademy.org", c:"Education", d:"12 min"},
        {t:"09:10", s:"youtube.com", c:"Video", d:"24 min"},
        {t:"10:05", s:"whatsapp.com", c:"Messaging", d:"8 min"},
        {t:"11:20", s:"wikipedia.org", c:"Reference", d:"6 min"},
        {t:"12:50", s:"instagram.com", c:"Social", d:"14 min"},
        {t:"15:15", s:"google.com", c:"Search", d:"5 min"},
        {t:"17:40", s:"tiktok.com", c:"Video", d:"18 min"},
      ];
      return {hours, mins, apps, totalMin, sites};
    }

    let state = demoData();
    function refreshDemo(){
      state = demoData();
      render();
    }

    // Stats
    function renderStats(){
      document.getElementById("statScreen").textContent = Math.round(state.totalMin/60) + "h " + (state.totalMin%60) + "m";
      const topApp = Object.entries(state.apps).sort((a,b)=>b[1]-a[1])[0][0];
      document.getElementById("statTopApp").textContent = topApp;
      document.getElementById("statSites").textContent = state.sites.length;
      document.getElementById("statSync").textContent = new Date().toLocaleTimeString();
    }

    // Table
    function renderTable(filter=""){
      const body = document.getElementById("rows");
      body.innerHTML = "";
      state.sites
        .filter(x => x.s.toLowerCase().includes(filter.toLowerCase()))
        .forEach(x=>{
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="py-2 pr-4">${x.t}</td>
            <td class="py-2 pr-4">${x.s}</td>
            <td class="py-2 pr-4">${x.c}</td>
            <td class="py-2">${x.d}</td>
          `;
          body.appendChild(tr);
        });
    }
    document.getElementById("search").addEventListener("input", e=>renderTable(e.target.value));

    // Charts
    let hoursChart, appsChart;
    function renderCharts(){
      const ctxH = document.getElementById("chartHours");
      const ctxA = document.getElementById("chartApps");
      if (hoursChart) hoursChart.destroy();
      if (appsChart) appsChart.destroy();

      hoursChart = new Chart(ctxH, {
        type: 'bar',
        data: {
          labels: state.hours.map(h=> (h%12||12)+ (h<12?" AM":" PM")),
          datasets: [{ label: 'Minutes', data: state.mins }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });

      appsChart = new Chart(ctxA, {
        type: 'doughnut',
        data: {
          labels: Object.keys(state.apps),
          datasets: [{ data: Object.values(state.apps) }]
        },
        options: { responsive: true }
      });
    }

    function render(){
      renderStats();
      renderTable();
      renderCharts();
    }
    render();
  </script>
</body>
</html>
